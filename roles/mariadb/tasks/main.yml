- name: Install mariadb server
  import_tasks: redhat.yml
  when: ansible_facts['os_family']|lower == 'redhat'

- name: Start server
  systemd:
    name: mariadb
    state: started
    enabled: yes
  become: yes

- name: Check if config exists
  stat:
    path: ~/.my.cnf
  register: config

- name: Initialize wordpress database
  when: not config.stat.exists
  block:
    - name: Copy .my.cnf file with root password credentials
      template: 
        src: .my.cnf
        dest: ~/.my.cnf
        mode: 600

    - name: Create user and database
      shell: |
          mysql -u root -e \
          "create database wordpress; \
           create user wordpressuser@localhost identified by '{{ mysql_password }}'; \
           grant all privileges on wordpress.* to wordpressuser@localhost identified by '{{ mysql_password }}'; \
           flush privileges;"
